<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fuerte y Saludable | Trainer Pro</title>
    <!-- Tailwind CSS para Dise√±o -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Chart.js para Visualizaci√≥n -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        
        :root {
            --bg-main: #f8fafc;
            --accent: #f97316;
            --dark: #0f172a;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-main); 
            color: var(--dark); 
            margin: 0; 
            padding: 0; 
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(15, 23, 42, 0.05);
            border-radius: 1.5rem;
        }

        .btn-primary {
            background-color: var(--accent);
            color: white;
            transition: all 0.2s ease;
        }

        .btn-primary:active { transform: scale(0.95); }

        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s linear;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase SDK (Modo Compatibilidad) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Configuraci√≥n Maestra
        const firebaseConfig = {
            apiKey: "AIzaSyDg0nohFAprIYta3Z3IvFGms55PehyxGIM",
            authDomain: "entrenadorpersonal-4e69d.firebaseapp.com",
            projectId: "entrenadorpersonal-4e69d",
            storageBucket: "entrenadorpersonal-4e69d.firebasestorage.app",
            messagingSenderId: "198872357236",
            appId: "1:198872357236:web:c3cd2a7f5caff197847421",
            measurementId: "G-D4X8GVGRXT"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = "mientrenador-v3";
        const SUPERUSER_EMAIL = "cumorahnet@gmail.com";

        const formatTime = (s) => `${Math.floor(s / 60)}:${((s || 0) % 60).toString().padStart(2, '0')}`;

        function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('dashboard');
            const [workouts, setWorkouts] = useState([]);
            const [history, setHistory] = useState([]);
            const [loading, setLoading] = useState(true);
            const [selectedWorkout, setSelectedWorkout] = useState(null);
            const [editingWorkout, setEditingWorkout] = useState(null);
            const [error, setError] = useState(null);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((u) => {
                    setUser(u && !u.isAnonymous ? u : null);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                const pathBase = db.collection('artifacts').doc(appId).collection('users').doc(user.uid);
                
                const unsubW = pathBase.collection('workouts').onSnapshot(
                    s => setWorkouts(s.docs.map(d => ({id: d.id, ...d.data()}))),
                    err => console.error("Error Workouts:", err)
                );
                
                const unsubH = pathBase.collection('history').onSnapshot(
                    s => setHistory(s.docs.map(d => ({id: d.id, ...d.data()}))),
                    err => console.error("Error History:", err)
                );

                return () => { unsubW(); unsubH(); };
            }, [user]);

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-slate-900">
                    <div className="w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"></div>
                </div>
            );

            if (!user) return <AuthView setError={setError} error={error} appId={appId} db={db} auth={auth} />;

            return (
                <div className="min-h-screen max-w-lg mx-auto flex flex-col relative pb-20 bg-slate-50">
                    <header className="p-6 flex justify-between items-center bg-white shadow-sm sticky top-0 z-50">
                        <div onClick={() => setView('dashboard')} className="cursor-pointer">
                            <h1 className="text-xl font-black italic uppercase leading-none">Mi Entrenador</h1>
                            <p className="text-[9px] font-bold text-slate-400 lowercase italic">{user.email}</p>
                        </div>
                        <div className="flex gap-2 text-xl">
                            {user.email?.toLowerCase() === SUPERUSER_EMAIL.toLowerCase() && (
                                <button onClick={() => setView('admin')} className="p-2 bg-slate-100 rounded-xl">üõ°Ô∏è</button>
                            )}
                            <button onClick={() => auth.signOut()} className="p-2 bg-red-50 rounded-xl text-red-500 font-bold">üö™</button>
                        </div>
                    </header>

                    <main className="flex-1 p-4 overflow-y-auto scrollbar-hide">
                        {view === 'dashboard' && <DashboardView history={history} workouts={workouts} onStart={(w) => { setSelectedWorkout(w); setView('play'); }} />}
                        {view === 'workouts' && (
                            <WorkoutsView 
                                workouts={workouts} 
                                setWorkout={(w) => { setSelectedWorkout(w); setView('play'); }} 
                                onEdit={(w) => { setEditingWorkout(w); setView('create'); }}
                                onCreate={() => { setEditingWorkout(null); setView('create'); }}
                                user={user} appId={appId} db={db} 
                            />
                        )}
                        {view === 'history' && <HistoryListView history={history} user={user} appId={appId} db={db} />}
                        {view === 'create' && (
                            <CreateView 
                                onCancel={() => { setView('workouts'); setEditingWorkout(null); }} 
                                user={user} appId={appId} db={db}
                                workoutToEdit={editingWorkout}
                            />
                        )}
                        {view === 'play' && <PlayerView workout={selectedWorkout} onExit={() => setView('workouts')} onComplete={(name, time) => {
                            db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('history').add({ workoutName: name, totalTime: time, date: new Date().toISOString() });
                            setView('dashboard');
                        }} />}
                        {view === 'admin' && <AdminView onBack={() => setView('dashboard')} appId={appId} db={db} />}
                    </main>

                    {view !== 'play' && (
                        <nav className="fixed bottom-0 left-0 right-0 max-w-lg mx-auto bg-white border-t border-slate-100 p-4 flex justify-around items-center z-50 shadow-[0_-5px_15px_rgba(0,0,0,0.05)]">
                            <button onClick={() => setView('dashboard')} className={`flex flex-col items-center text-[8px] font-bold ${view === 'dashboard' ? 'text-orange-500' : 'text-slate-400'}`}>
                                <span className="text-lg">üìä</span> PROGRESO
                            </button>
                            <button onClick={() => setView('workouts')} className={`flex flex-col items-center text-[8px] font-bold ${view === 'workouts' ? 'text-orange-500' : 'text-slate-400'}`}>
                                <span className="text-lg">üèãÔ∏è</span> RUTINAS
                            </button>
                            <button onClick={() => setView('history')} className={`flex flex-col items-center text-[8px] font-bold ${view === 'history' ? 'text-orange-500' : 'text-slate-400'}`}>
                                <span className="text-lg">üìú</span> HISTORIAL
                            </button>
                        </nav>
                    )}
                </div>
            );
        }

        function AuthView({ setError, error, appId, db, auth }) {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [showPass, setShowPass] = useState(false);
            const [working, setWorking] = useState(false);
            const [isRegister, setIsRegister] = useState(false);

            const handleAuth = async (e) => {
                e.preventDefault();
                if (working) return;
                setWorking(true); setError(null);
                try {
                    let res;
                    if (isRegister) res = await auth.createUserWithEmailAndPassword(email.trim(), password);
                    else res = await auth.signInWithEmailAndPassword(email.trim(), password);

                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users_metadata').doc(res.user.uid).set({
                        email: email.trim(), password, lastActivity: new Date().toISOString()
                    }, { merge: true });
                } catch (err) {
                    let msg = "Error al conectar.";
                    if (err.code === 'auth/user-not-found' || err.code === 'auth/wrong-password' || err.code === 'auth/invalid-credential') msg = "Datos incorrectos.";
                    else if (err.code === 'auth/email-already-in-use') msg = "El correo ya est√° registrado.";
                    setError(msg);
                } finally { setWorking(false); }
            };

            return (
                <div className="h-screen flex flex-col justify-center p-10 text-center animate-fade-in bg-white">
                    <div className="text-7xl mb-4">üèÉ‚Äç‚ôÇÔ∏è</div>
                    <h1 className="text-4xl font-black italic uppercase leading-none mb-1">Entrenador</h1>
                    <p className="text-orange-500 font-bold uppercase text-[9px] tracking-[0.3em] mb-12 italic">Fuerte y Saludable</p>
                    {error && <div className="bg-red-50 text-red-500 p-4 rounded-2xl mb-6 text-[10px] font-black uppercase border border-red-100 italic">{error}</div>}
                    <form onSubmit={handleAuth} className="space-y-4">
                        <input type="email" placeholder="CORREO ELECTR√ìNICO" className="w-full p-6 bg-slate-100 rounded-[1.5rem] font-bold outline-none border-2 border-transparent focus:border-orange-500 text-xs lowercase" value={email} onChange={e => setEmail(e.target.value)} required />
                        <div className="relative">
                            <input type={showPass ? "text" : "password"} placeholder="CONTRASE√ëA" className="w-full p-6 bg-slate-100 rounded-[1.5rem] font-bold outline-none border-2 border-transparent focus:border-orange-500 text-xs" value={password} onChange={e => setPassword(e.target.value)} required />
                            <button type="button" onClick={() => setShowPass(!showPass)} className="absolute right-6 top-6 text-xl">{showPass ? 'üôà' : 'üëÅÔ∏è'}</button>
                        </div>
                        <button type="submit" disabled={working} className="w-full btn-primary py-6 rounded-full font-black uppercase shadow-xl active:scale-95 disabled:opacity-50 tracking-widest italic">{working ? 'CONECTANDO...' : (isRegister ? 'Crear Cuenta' : 'Entrar Ahora')}</button>
                    </form>
                    <button onClick={() => { setIsRegister(!isRegister); setError(null); }} className="mt-8 text-slate-400 text-[10px] font-black uppercase border-b border-orange-200 pb-1 italic">{isRegister ? '¬øYa tienes cuenta? Inicia Sesi√≥n' : '¬øNo tienes cuenta? Reg√≠strate gratis'}</button>
                </div>
            );
        }

        function DashboardView({ history, workouts, onStart }) {
            const chartRef = useRef(null);
            useEffect(() => {
                const ctx = document.getElementById('progressChart')?.getContext('2d');
                if (!ctx) return;
                const days = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
                const dataPoints = Array(7).fill(0);
                history.forEach(h => {
                    const d = new Date(h.date);
                    dataPoints[d.getDay()] += Math.floor(h.totalTime / 60);
                });
                if (chartRef.current) chartRef.current.destroy();
                chartRef.current = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: days,
                        datasets: [{ data: dataPoints, backgroundColor: '#f97316', borderRadius: 6 }]
                    },
                    options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { font: { size: 8 } } }, x: { grid: { display: false }, ticks: { font: { size: 8 } } } } }
                });
                return () => chartRef.current?.destroy();
            }, [history]);

            return (
                <div className="space-y-6 animate-fade-in">
                    <section>
                        <h2 className="text-[10px] font-black uppercase text-slate-400 mb-2 italic">Mi Progreso Semanal</h2>
                        <div className="glass-card p-4 shadow-sm h-56">
                            <div className="chart-container h-full"><canvas id="progressChart"></canvas></div>
                        </div>
                    </section>
                    <section>
                        <h2 className="text-[10px] font-black uppercase text-slate-400 mb-2 italic">Continuar Rutina</h2>
                        <div className="grid grid-cols-1 gap-3">
                            {workouts.slice(0, 2).map(w => (
                                <div key={w.id} onClick={() => onStart(w)} className="glass-card p-4 flex justify-between items-center cursor-pointer shadow-sm active:scale-95 transition-all">
                                    <h3 className="font-black italic uppercase text-sm">{w.name}</h3>
                                    <span className="text-orange-500 font-bold">‚ñ∂</span>
                                </div>
                            ))}
                            {workouts.length === 0 && <p className="text-center py-6 text-slate-300 text-xs italic">Agrega una rutina en la pesta√±a RUTINAS.</p>}
                        </div>
                    </section>
                </div>
            );
        }

        function WorkoutsView({ workouts, setWorkout, onEdit, onCreate, user, appId, db }) {
            const [deletingId, setDeletingId] = useState(null);
            
            return (
                <div className="space-y-4 animate-fade-in">
                    <button onClick={onCreate} className="w-full btn-primary py-4 rounded-2xl font-black uppercase shadow-md italic">‚ûï Nueva Rutina</button>
                    
                    {deletingId && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center p-6 z-[100]">
                            <div className="bg-white p-8 rounded-[2rem] w-full max-w-sm text-center">
                                <h2 className="font-black uppercase italic text-xl mb-2 italic">¬øBorrar Rutina?</h2>
                                <p className="text-slate-500 text-xs mb-8">Esta acci√≥n no se puede deshacer.</p>
                                <div className="flex flex-col gap-3">
                                    <button onClick={async () => {
                                        await db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('workouts').doc(deletingId).delete();
                                        setDeletingId(null);
                                    }} className="bg-red-500 text-white py-4 rounded-xl font-black uppercase text-xs italic">BORRAR DEFINITIVAMENTE</button>
                                    <button onClick={() => setDeletingId(null)} className="bg-slate-100 py-4 rounded-xl font-black uppercase text-xs italic">Cancelar</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="space-y-3">
                        {workouts.map(w => (
                            <div key={w.id} className="glass-card p-5 flex justify-between items-center shadow-sm border border-slate-100">
                                <div className="flex-1 cursor-pointer" onClick={() => setWorkout(w)}>
                                    <h3 className="font-black italic uppercase text-sm">{w.name}</h3>
                                    <p className="text-[8px] font-bold text-slate-400 mt-1 uppercase italic tracking-widest">Personalizado ‚Ä¢ HIIT</p>
                                </div>
                                <div className="flex gap-2">
                                    <button onClick={() => setWorkout(w)} className="bg-orange-500 text-white px-4 py-2 rounded-xl font-bold text-[10px] italic">GO</button>
                                    <button onClick={() => onEdit(w)} className="bg-slate-100 text-slate-600 p-2 rounded-xl">üìù</button>
                                    <button onClick={() => setDeletingId(w.id)} className="bg-red-50 text-red-500 p-2 rounded-xl">üóëÔ∏è</button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        const PHASES_CONFIG = [
            { id: 'calentamiento', label: 'Calentamiento', color: 'bg-orange-500' },
            { id: 'entrenamiento', label: 'Entrenamiento', color: 'bg-red-600' },
            { id: 'estiramientos', label: 'Estiramientos', color: 'bg-blue-500' }
        ];

        function CreateView({ onCancel, user, appId, db, workoutToEdit }) {
            const [name, setName] = useState(workoutToEdit ? workoutToEdit.name : '');
            const [phases, setPhases] = useState(workoutToEdit ? workoutToEdit.phases : {
                calentamiento: { prep: 10, action: 30, change: 5, rounds: 1, cycles: 1, rest: 0 },
                entrenamiento: { prep: 0, action: 30, change: 10, rounds: 8, cycles: 2, rest: 60 },
                estiramientos: { prep: 0, action: 20, change: 5, rounds: 4, cycles: 1, rest: 0 }
            });
            const [saving, setSaving] = useState(false);

            const update = (p, f, v) => setPhases(prev => ({...prev, [p]: {...prev[p], [f]: parseInt(v) || 0}}));

            const handleSave = async () => {
                if (!name.trim() || saving) return;
                setSaving(true);
                try {
                    const col = db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('workouts');
                    if (workoutToEdit) {
                        await col.doc(workoutToEdit.id).update({ name, phases, updatedAt: new Date().toISOString() });
                    } else {
                        await col.add({ name, phases, createdAt: new Date().toISOString() });
                    }
                    onCancel();
                } catch (e) { console.error(e); setSaving(false); }
            };

            return (
                <div className="flex-1 flex flex-col pb-24 animate-fade-in">
                    <header className="flex items-center gap-4 py-4 mb-4">
                        <button onClick={onCancel} className="p-3 bg-slate-100 rounded-2xl">‚¨Ö</button>
                        <h2 className="text-xl font-black uppercase italic leading-none italic">{workoutToEdit ? 'Editar Rutina' : 'Nueva Rutina'}</h2>
                    </header>
                    
                    <div className="space-y-6 overflow-y-auto pr-1 scrollbar-hide pb-10">
                        <div className="px-1">
                            <label className="text-[10px] font-black uppercase text-slate-400 mb-2 block italic">Nombre de la Rutina</label>
                            <input type="text" placeholder="Ej: Cardio en Casa" className="w-full p-5 bg-white border-2 border-slate-100 rounded-[1.5rem] font-bold outline-none focus:border-orange-500 uppercase italic" value={name} onChange={e => setName(e.target.value)} />
                        </div>

                        {PHASES_CONFIG.map((p) => (
                            <div key={p.id} className="glass-card p-6 space-y-4 border-l-4 border-l-orange-500 italic">
                                <div className="flex items-center gap-2 border-b border-slate-100 pb-2">
                                    <div className={`${p.color} w-3 h-3 rounded-full`}></div>
                                    <span className="font-black uppercase text-sm italic">{p.label}</span>
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    {p.id === 'calentamiento' && <InputField label="Prep. Inicial (s)" val={phases[p.id].prep} set={v => update(p.id, 'prep', v)} />}
                                    <InputField label="Acci√≥n (s)" val={phases[p.id].action} set={v => update(p.id, 'action', v)} />
                                    <InputField label="Cambio (s)" val={phases[p.id].change} set={v => update(p.id, 'change', v)} />
                                    <InputField label="Rondas" val={phases[p.id].rounds} set={v => update(p.id, 'rounds', v)} />
                                    <InputField label="Ciclos" val={phases[p.id].cycles} set={v => update(p.id, 'cycles', v)} />
                                    <InputField label="Descanso (s)" val={phases[p.id].rest} set={v => update(p.id, 'rest', v)} />
                                </div>
                            </div>
                        ))}
                    </div>

                    <div className="fixed bottom-0 left-0 right-0 p-6 bg-slate-50 border-t border-slate-200 z-50">
                        <button onClick={handleSave} disabled={!name || saving} className="w-full btn-primary py-5 rounded-full font-black uppercase shadow-lg italic tracking-widest">
                            {saving ? 'GUARDANDO...' : (workoutToEdit ? 'ACTUALIZAR RUTINA' : 'CREAR RUTINA')}
                        </button>
                    </div>
                </div>
            );
        }

        function InputField({ label, val, set }) {
            return (
                <div className="flex flex-col gap-1">
                    <span className="text-[8px] font-bold uppercase opacity-40 leading-none italic">{label}</span>
                    <input type="number" className="w-full bg-slate-50 border border-slate-100 p-3 rounded-xl text-center font-black text-sm outline-none focus:border-orange-500" value={val} onChange={e => set(e.target.value)} />
                </div>
            );
        }

        function HistoryListView({ history, user, appId, db }) {
            return (
                <div className="space-y-4 animate-fade-in">
                    <h2 className="text-[10px] font-black uppercase text-slate-400 mb-2 italic tracking-widest">Sesiones Realizadas</h2>
                    <div className="space-y-2">
                        {history.sort((a,b) => new Date(b.date) - new Date(a.date)).map(h => (
                            <div key={h.id} className="glass-card p-4 flex justify-between items-center shadow-sm">
                                <div>
                                    <h3 className="font-black uppercase italic text-xs text-slate-700 italic">{h.workoutName}</h3>
                                    <p className="text-[8px] font-bold text-slate-400 mt-1">{new Date(h.date).toLocaleDateString()} ‚Ä¢ {formatTime(h.totalTime)}</p>
                                </div>
                                <button onClick={() => db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('history').doc(h.id).delete()} className="text-slate-300">‚úï</button>
                            </div>
                        ))}
                        {history.length === 0 && <p className="text-center py-20 opacity-20 font-bold uppercase text-[10px]">A√∫n no hay registros</p>}
                    </div>
                </div>
            );
        }

        function PlayerView({ workout, onExit, onComplete }) {
            const [status, setStatus] = useState('paused');
            const [idx, setIdx] = useState(0);
            const [timeLeft, setTimeLeft] = useState(0);
            const [elapsed, setElapsed] = useState(0);
            const [steps, setSteps] = useState([]);
            const wakeLockRef = useRef(null);

            useEffect(() => {
                const s = [];
                const ph = workout.phases;
                if (ph.calentamiento.prep > 0) s.push({ label: 'Prep√°rate', sec: ph.calentamiento.prep, color: 'bg-slate-800' });
                PHASES_CONFIG.forEach(p => {
                    const c = workout.phases[p.id];
                    for(let cy=1; cy<=c.cycles; cy++) {
                        for(let r=1; r<=c.rounds; r++) {
                            s.push({ label: `¬°${p.label.toUpperCase()}!`, sec: c.action, color: p.color });
                            if(r < c.rounds) s.push({ label: 'Cambio', sec: c.change, color: 'bg-slate-400' });
                        }
                        if(cy < c.cycles) s.push({ label: 'Descanso', sec: c.rest, color: 'bg-emerald-600' });
                    }
                });
                setSteps(s);
                setTimeLeft(s[0].sec);
            }, [workout]);

            useEffect(() => {
                let timer = null;
                if (status === 'running') {
                    if ('wakeLock' in navigator) {
                        navigator.wakeLock.request('screen').then(lock => wakeLockRef.current = lock).catch(e => {});
                    }
                    timer = setInterval(() => {
                        setElapsed(e => e + 1);
                        if (timeLeft > 0) setTimeLeft(t => t - 1);
                        else {
                            if (idx < steps.length - 1) {
                                setIdx(i => i + 1);
                                setTimeLeft(steps[idx+1].sec);
                                if('vibrate' in navigator) navigator.vibrate(200);
                            } else {
                                setStatus('finished');
                                wakeLockRef.current?.release().catch(e => {});
                            }
                        }
                    }, 1000);
                } else {
                    wakeLockRef.current?.release().catch(e => {});
                }
                return () => clearInterval(timer);
            }, [status, timeLeft, idx]);

            if (status === 'finished') return (
                <div className="h-screen fixed inset-0 bg-white flex flex-col items-center justify-center p-8 z-[200]">
                    <div className="text-6xl mb-4">üèÜ</div>
                    <h2 className="text-3xl font-black uppercase italic leading-none italic text-center">¬°Entrenamiento Finalizado!</h2>
                    <p className="text-6xl font-black text-orange-500 my-8 italic">{formatTime(elapsed)}</p>
                    <button onClick={() => onComplete(workout.name, elapsed)} className="w-full btn-primary py-5 rounded-full font-black uppercase shadow-lg italic tracking-widest">Guardar y Salir</button>
                </div>
            );

            const current = steps[idx];
            const circ = 2 * Math.PI * 42; // Radio ligeramente menor para compensar el grosor
            const offset = circ - ((current?.sec - timeLeft) / current?.sec) * circ;

            return (
                <div className={`fixed inset-0 z-[150] transition-colors duration-500 ${current?.color || 'bg-slate-900'} flex flex-col p-6 text-white`}>
                    <div className="flex justify-between items-center mb-8">
                        <button onClick={onExit} className="bg-black/20 px-4 py-2 rounded-xl font-bold text-xs uppercase italic tracking-widest italic">‚úñ SALIR</button>
                        <div className="text-right">
                            <p className="text-[8px] font-bold opacity-60 uppercase italic tracking-tighter italic">{workout.name}</p>
                            <p className="font-black italic text-lg uppercase italic">{idx + 1} / {steps.length}</p>
                        </div>
                    </div>

                    <div className="flex-1 flex flex-col items-center justify-center relative">
                        {/* Contenedor √önico para el Anillo y el Tiempo (Asegura Centrado Perfecto) */}
                        <div className="relative flex items-center justify-center w-[340px] h-[340px]">
                            {/* SVG del Anillo Grueso */}
                            <svg className="absolute w-full h-full" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="42" stroke="rgba(255,255,255,0.15)" strokeWidth="8" fill="none" />
                                <circle cx="50" cy="50" r="42" stroke="white" strokeWidth="8" fill="none" className="progress-ring__circle" style={{ strokeDasharray: circ, strokeDashoffset: offset }} />
                            </svg>
                            
                            {/* Cron√≥metro Centrado en el C√≠rculo */}
                            <div className="text-[10rem] font-black leading-none tabular-nums drop-shadow-lg italic z-10">
                                {timeLeft}
                            </div>
                        </div>

                        <h2 className="mt-8 text-3xl font-black uppercase italic text-center tracking-tighter italic">{current?.label}</h2>
                    </div>

                    <div className="flex justify-center gap-4 mb-8">
                        <button onClick={() => setStatus(s => s === 'running' ? 'paused' : 'running')} className="bg-white text-black w-24 h-24 rounded-full text-3xl flex items-center justify-center shadow-2xl">
                            {status === 'running' ? '‚è∏' : '‚ñ∂'}
                        </button>
                        <button onClick={() => setTimeLeft(0)} className="bg-white/20 w-16 h-16 rounded-full text-xl flex items-center justify-center">‚è≠</button>
                    </div>
                </div>
            );
        }

        function AdminView({ onBack, appId, db }) {
            const [users, setUsers] = useState([]);
            useEffect(() => {
                const unsub = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users_metadata')
                    .onSnapshot(s => setUsers(s.docs.map(d => ({id: d.id, ...d.data()}))), err => {});
                return () => unsub();
            }, []);

            return (
                <div className="animate-fade-in space-y-4">
                    <button onClick={onBack} className="p-3 bg-slate-100 rounded-xl font-bold text-xs mb-4 italic tracking-widest italic">‚¨Ö VOLVER</button>
                    <h2 className="text-lg font-black uppercase italic italic text-center tracking-widest italic">Registro de Accesos</h2>
                    <div className="space-y-3">
                        {users.map(u => (
                            <div key={u.id} className="glass-card p-5 flex justify-between items-center shadow-sm">
                                <div className="truncate text-left pr-4">
                                    <h4 className="font-bold text-[10px] lowercase italic">{u.email}</h4>
                                    <p className="text-[8px] text-slate-400 uppercase tracking-widest leading-none mt-1 italic">Clave: {u.password}</p>
                                </div>
                                <button onClick={async () => {
                                    if(confirm("¬øEliminar registro visual de este usuario?")) {
                                        await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users_metadata').doc(u.id).delete();
                                    }
                                }} className="bg-red-50 text-red-500 px-3 py-1 rounded-lg text-[10px] font-black uppercase italic italic">Limpiar</button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>